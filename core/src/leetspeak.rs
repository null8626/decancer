// SPDX-License-Identifier: MIT
// SPDX-FileCopyrightText: 2021-2026 null8626

use std::sync::LazyLock;

use regex::bytes::{Regex, RegexBuilder};

macro_rules! re {
  ($pattern:literal) => {{
    Some(
      RegexBuilder::new($pattern)
        .unicode(false)
        .dfa_size_limit(83886080)
        .build()
        .unwrap(),
    )
  }};
}

#[allow(clippy::trivial_regex)]
pub static REGEXES: LazyLock<[Option<Regex>; 26]> = LazyLock::new(|| {
  [
    re!(r"^(?:\/-*\\|[\[\(\{<]L)"),
    re!(r"^[\\\/\[\]\{\}\(\)\:\|iIljJ17T!](?:3|\-*[\]\)\}>])"),
    None,
    re!(
      r"^(?:[\\\/\[\{\(\:\|iIljJ1T!][\]\}\)>7]|\][\}\)>7]|\}[\]\)>7]|\)[\]\}>7]|7[\]\}\)>]|c[\\\/\[\{\(\:\|iIljJ1T!])"
    ),
    re!(r"^[\(\{\[<cC]\-+"),
    re!(r"^[\\\/\[\]\{\}\(\)\:\|iIljJ17T!]=+"),
    re!(r"^[\(\{\[<cC]_*[\+,\.]"),
    re!(r"^(?:\}\{|[\\\/\[\]\{\}\(\)\:\|iIljJ17T!][\-~\+]+[\\\/\[\]\{\}\(\)\:\|iIljJ17T!])"),
    re!(r"^\]\["),
    re!(r"^[\,\.\+]?_+[\\\/\[\]\{\}\(\)\:\|iIljJ17T!]"),
    re!(r"^(?:[\\\/\]\}\)\:\|iIljJ17T!][\(\{\[<cC]|\[[\(\{<cC]|\([\{<cC]|\{[<cC])"),
    re!(r"^[\\\/\[\]\{\}\(\)\:\|iIljJ17T!]_+"),
    re!(
      r"^(?:[\/\[\]\{\}\(\)\:\|iIljJ17T!<cC](?:[vV]|\\_*\/)[>\\\[\]\{\}\(\)\:\|iIljJ17T!L]|(?:[\/\[\]\{\}\(\)\:\|iIljJ17T!]\\|\/[\\\[\]\{\}\(\)\:\|iIljJ17T!L]){2}|[n1^][-_]*[n1^]|rn|N\\)"
    ),
    re!(r"^(?:[\/\[\]\{\}\(\)\:\|iIljJ17T!<cC]\\[>\/\[\]\{\}\(\)\:\|iIljJ17T!]|\/[vV]|^\/)"),
    re!(r"^[\(\{\[<cC][\]\}\)>7]"),
    re!(r"^[\\\/\[\]\{\}\(\)\:\|iIljJ17T!][o0\*^]"),
    re!(r"^(?:[\(\{\[<cC][\]\}\)>7]|[oO0])_+"),
    re!(r"^[\\\/\[\]\{\}\(\)\:\|iIljJ17T!][2Zz`\?]"),
    None,
    re!(r"^[\-~]+[\\\/\[\]\{\}\(\)\:\|iIljJ17T!][\-~]+"),
    re!(
      r"^(?:[\\\/\[\]\{\}\(\)\:\|iIljJ17T!<]_+[>\\\/\[\]\{\}\(\)\:\|iIljJ17T!]|L[\\\/\[\]\{\}\(\)\:\|iIljJ17T!])"
    ),
    re!(r"^(?:[\\\[\]\{\}\(\)\:\|iIljJ17T!]\/|\\[\/\[\]\{\}\(\)\:\|iIljJ17T!]|\\\|)"),
    re!(
      r"^(?:[\\\[\]\{\}\(\)\:\|iIljJ17T!<cCL]_*(?:(?:\/\\|[xXn^])_*[>\/\[\]\{\}\(\)\:\|iIljJ17T!]|N)|(?:[\\\[\]\{\}\(\)\:\|iIljJ17T!L]_*\/|\\[\/\[\]\{\}\(\)\:\|iIljJ17T!]|[vVuU]){2})"
    ),
    re!(r"^[>\}\)\]][<\{\(\[]"),
    re!(r"^`\/"),
    re!(r"^(?:([~\-][\\\/])|[7>])_+"),
  ]
});

#[cfg(feature = "options")]
#[allow(clippy::trivial_regex)]
pub static NON_ALPHABETICAL_REGEXES: LazyLock<[Option<Regex>; 26]> = LazyLock::new(|| {
  [
    re!(r"^\/-*\\"),
    re!(r"^[\\\/\[\]\{\}\(\)\:\|17!](?:3|\-*[\]\)\}>])"),
    None,
    re!(r"^(?:[\\\/\[\{\(\:\|1!][\]\}\)>7]|\][\}\)>7]|\}[\]\)>7]|\)[\]\}>7]|7[\]\}\)>])"),
    re!(r"^[\(\{\[<]\-+"),
    re!(r"^[\\\/\[\]\{\}\(\)\:\|17!]=+"),
    re!(r"^[\(\{\[<]_*[\+,\.]"),
    re!(r"^(?:\}\{|[\\\/\[\]\{\}\(\)\:\|17!][\-~\+]+[\\\/\[\]\{\}\(\)\:\|17!])"),
    re!(r"^\]\["),
    re!(r"^[\,\.\+]?_+[\\\/\[\]\{\}\(\)\:\|17!]"),
    re!(r"^(?:[\\\/\]\}\)\:\|17!][\(\{\[<]|\[[\(\{<]|\([\{<]|\{<)"),
    re!(r"^[\\\/\[\]\{\}\(\)\:\|17!]_+"),
    re!(
      r"^(?:[\/\[\]\{\}\(\)\:\|17!<]\\_*\/[>\\\[\]\{\}\(\)\:\|17!]|(?:[\/\[\]\{\}\(\)\:\|17!]\\|\/[\\\[\]\{\}\(\)\:\|17!]){2}|[1^][-_]*[1^])"
    ),
    re!(r"^(?:[\/\[\]\{\}\(\)\:\|17!<]\\[>\/\[\]\{\}\(\)\:\|17!]|^\/)"),
    re!(r"^[\(\{\[<][\]\}\)>7]"),
    re!(r"^[\\\/\[\]\{\}\(\)\:\|17!][0\*^]"),
    re!(r"^(?:[\(\{\[<][\]\}\)>7]|0)_+"),
    re!(r"^[\\\/\[\]\{\}\(\)\:\|17!][2`\?]"),
    None,
    re!(r"^[\-~]+[\\\/\[\]\{\}\(\)\:\|17!][\-~]+"),
    re!(r"^(?:[\\\/\[\]\{\}\(\)\:\|17!<]_+[>\\\/\[\]\{\}\(\)\:\|17!])"),
    re!(r"^(?:[\\\[\]\{\}\(\)\:\|17!]\/|\\[\/\[\]\{\}\(\)\:\|17!]|\\\|)"),
    re!(
      r"^(?:[\\\[\]\{\}\(\)\:\|17!<]_*(?:(?:\/\\|^)_*[>\/\[\]\{\}\(\)\:\|17!])|(?:[\\\[\]\{\}\(\)\:\|17!]_*\/|\\[\/\[\]\{\}\(\)\:\|17!]){2})"
    ),
    re!(r"^[>\}\)\]][<\{\(\[]"),
    re!(r"^`\/"),
    re!(r"^(?:([~\-][\\\/])|[7>])_+"),
  ]
});

pub fn find(
  regexes: &LazyLock<[Option<Regex>; 26]>,
  haystack: &[u8],
  character: u32,
) -> Option<usize> {
  regexes[match character {
    65..=90 => character - 65,

    97..=122 => character - 97,

    _ => return None,
  } as usize]
    .as_ref()?
    .find(haystack)
    .map(|mat| mat.len())
}
